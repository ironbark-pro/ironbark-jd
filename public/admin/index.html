<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>IRONBARK Admin</title>
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  </head>
  <body>
    <!-- Include the script that builds the page and powers Netlify CMS -->
    <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>
        <script>
      // Custom enhancements for Decap CMS
      window.addEventListener('load', function() {
        // Wait for CMS to load
        setTimeout(function() {
          // Add "View Published Jobs" link to sidebar
          const sidebar = document.querySelector('[class*="SidebarContainer"]') || document.querySelector('aside') || document.querySelector('nav');
          if (sidebar) {
            const link = document.createElement('a');
            link.href = '/jobs';
            link.target = '_blank';
            link.textContent = 'üìã View Published Jobs';
            link.style.cssText = 'display:block;padding:12px 16px;color:#D4A63A;text-decoration:none;font-weight:500;border-top:1px solid #eee;margin-top:auto;';
            link.onmouseover = function() { this.style.backgroundColor = '#f5f5f5'; };
            link.onmouseout = function() { this.style.backgroundColor = 'transparent'; };
            sidebar.appendChild(link);
          }
          
          // Add preview buttons to job entries
          const addPreviewButtons = function() {
            const entries = document.querySelectorAll('[class*="ListCard"]');
            entries.forEach(function(entry) {
              if (!entry.querySelector('.custom-preview-btn')) {
                const titleEl = entry.querySelector('h2') || entry.querySelector('[class*="ListCardTitle"]');
                if (titleEl) {
                  const jobTitle = titleEl.textContent.trim();
                  const slug = jobTitle.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-|-$/g, '');
                  
                  const btnContainer = document.createElement('div');
                  btnContainer.className = 'custom-preview-btn';
                  btnContainer.style.cssText = 'margin-top:8px;';
                  
                  const previewBtn = document.createElement('a');
                  previewBtn.href = '/jobs/' + slug + '.html';
                  previewBtn.target = '_blank';
                  previewBtn.textContent = 'üëÅ Preview';
                  previewBtn.style.cssText = 'display:inline-block;padding:6px 12px;background:#D4A63A;color:white;text-decoration:none;border-radius:4px;font-size:12px;margin-right:8px;';
                  
                  btnContainer.appendChild(previewBtn);
                  entry.appendChild(btnContainer);
                }
              }
            });
          };
          
          // Run initially and on DOM changes
          // addPreviewButtons();
          // const observer = new MutationObserver(addPreviewButtons);
          // observer.observe(document.body, { childList: true, subtree: true });
        }, 1000);
      });
    </script>
  </body>
</html>
